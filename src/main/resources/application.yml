# =============================================================================
# Required Environment Variables / API Keys
# =============================================================================
#
# Neo4j Database (optional - defaults provided for local dev):
#   NEO4J_HOST, NEO4J_PORT, NEO4J_USERNAME, NEO4J_PASSWORD, NEO4J_DATABASE, NEO4J_HTTP_PORT
#
# OpenAI API (required for LLM, TTS, and embeddings):
#   OPENAI_API_KEY - Get from https://platform.openai.com/api-keys
#
# Google OAuth2 (required for user authentication):
#   GOOGLE_CLIENT_ID - Get from https://console.cloud.google.com/apis/credentials
#   GOOGLE_CLIENT_SECRET
#
# Spotify (optional - for playlist management):
#   SPOTIFY_CLIENT_ID - Get from https://developer.spotify.com/dashboard
#   SPOTIFY_CLIENT_SECRET
#
# YouTube Data API v3 (optional - for video search):
#   YOUTUBE_API_KEY - Get from https://console.cloud.google.com/apis/credentials
#                     Enable "YouTube Data API v3" first
#
# Brave Search MCP (optional - for web search):
#   BRAVE_API_KEY - Get from https://brave.com/search/api/
#
# =============================================================================

database:
  datasources:
    neo:
      type: NEO4J
      host: ${NEO4J_HOST:localhost}
      port: ${NEO4J_PORT:7888}
      user-name: ${NEO4J_USERNAME:neo4j}
      password: ${NEO4J_PASSWORD:brahmsian}
      database-name: ${NEO4J_DATABASE:neo4j}

neo4j:
  http:
    port: ${NEO4J_HTTP_PORT:8889}

impromptu:


  neo-rag: {}

  chunker-config:
    max-chunk-size: 800
    overlap-size: 100
    embedding-batch-size: 800

  chat-llm:
    model: gpt-4.1-mini
    temperature: 0.0

  proposition-extraction-llm:
    model: gpt-4.1-mini
    temperature: 0.0

  entity-resolution-llm:
    model: gpt-4.1-mini
    temperature: 0.0

  default-voice:
    persona: impromptu
    max-words: 70

  speech:
    tts-model: tts-1
    tts-voice: nova
    api-key: ${OPENAI_API_KEY:}

  extraction:
    window-size: 10
    overlap-size: 2
    trigger-interval: 10

  objective: music
  behaviour: default

  show-extraction-prompts: true
  show-extraction-responses: false
  embedding-service: text-embedding-3-small
  conversation-window: 60
  show-chat-prompts: true

# YouTube Data API v3
# To set up:
# 1. Go to https://console.cloud.google.com/
# 2. Enable the YouTube Data API v3
# 3. Create an API key (no OAuth needed for search)
# 4. Set YOUTUBE_API_KEY environment variable
youtube:
  api-key: ${YOUTUBE_API_KEY:}

# DICE (Domain-Integrated Context Engineering) REST API Security
# This enables API key authentication for DICE endpoints (/api/v1/**)
# Use the X-API-Key header with the configured key to access the API
dice:
  security:
    api-key:
      enabled: true
      keys:
        - impromptu-admin

embabel:

  agent:
    logging:
      personality: colossus

  models:

    # Change this to use a non Open AI default LLM
    default-llm:
      model: gpt-4.1-mini


logging:
  level:
    # Entity resolution debug logging
    com.embabel.dice.common.resolver: DEBUG
    com.embabel.dice.common.resolver.searcher: DEBUG
    # MatryoshkaTool debugging
    com.embabel.agent.spi.loop.MatryoshkaToolInjectionStrategy: DEBUG
    com.embabel.agent.spi.loop.support.DefaultToolLoop: DEBUG

server:
  port: 8888  # Double the 88 piano keys
  servlet:
    async:
      timeout: 600000  # 10 minutes for long-running operations like OpenOpus load

spring:

  # MCP (Model Context Protocol) tools
  # Wikipedia MCP provides tools to search and read Wikipedia articles
  # Requires Docker to be running
  ai:
    mcp:
      client:
        enabled: true
        name: impromptu
        version: 1.0.0
        request-timeout: 30s
        type: SYNC
        stdio:
          connections:
            # Wikipedia MCP - search and read Wikipedia articles
            # Workaround: wikipedia-mcp prints a startup banner to stdout which breaks
            # the MCP stdio protocol. We filter to only pass JSON lines.
            # See: https://github.com/Rudra-ravi/wikipedia-mcp/issues/39
            wikipedia-mcp:
              command: sh
              args:
                - -c
                - "docker run -i --rm mcp/wikipedia-mcp | grep --line-buffered '^{'"
            # Brave Search MCP - web search via Brave Search API
            # Requires BRAVE_API_KEY from https://brave.com/search/api/
            brave-search-mcp:
              command: docker
              args:
                - run
                - -i
                - --rm
                - -e
                - BRAVE_API_KEY
                - mcp/brave-search
              env:
                BRAVE_API_KEY: ${BRAVE_API_KEY}

  # Google OAuth2 Configuration
  # To set up Google OAuth2:
  # 1. Go to https://console.cloud.google.com/
  # 2. Create a new project or select an existing one
  # 3. Navigate to APIs & Services > Credentials
  # 4. Create an OAuth client ID (Web application type)
  # 5. Add authorized redirect URIs: http://127.0.0.1:8888/login/oauth2/code/google
  # 6. Copy the client ID and client secret below
  # 7. Access the app via http://127.0.0.1:8888 (not localhost)
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID}
            client-secret: ${GOOGLE_CLIENT_SECRET}
            scope: email,profile
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
          # Spotify OAuth2 for playlist management (linked after Google login)
          # To set up Spotify:
          # 1. Go to https://developer.spotify.com/dashboard
          # 2. Create an app
          # 3. Add redirect URI: http://127.0.0.1:8888/callback/spotify (loopback, not localhost)
          # 4. Add yourself as a user in User Management (for dev mode)
          # 5. Copy client ID and secret below
          # 6. Access the app via http://127.0.0.1:8888 (not localhost)
          spotify:
            client-id: ${SPOTIFY_CLIENT_ID:}
            client-secret: ${SPOTIFY_CLIENT_SECRET:}
            scope: playlist-modify-public,playlist-modify-private,playlist-read-private,user-library-read,user-read-playback-state,user-modify-playback-state,user-read-recently-played,user-top-read
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/callback/spotify"
        provider:
          spotify:
            authorization-uri: https://accounts.spotify.com/authorize
            token-uri: https://accounts.spotify.com/api/token
            user-info-uri: https://api.spotify.com/v1/me
            user-name-attribute: id
